# Monkey ğŸ’å…³ç³»å¼æ±‚è§£å™¨

>ç®€å•ã€å¹²å‡€ã€ä¸ä½œåšï¼Œè¯­ä¹‰å…ˆäºæ–‡æ³•çš„ 200 è¡Œé€»è¾‘å…³ç³» __ç¼–ç¨‹æ¡†æ¶ã€è§£é‡Šå™¨__ï¼Œå¿«é€Ÿå…¥é—¨ relational ç¼–ç¨‹èŒƒå¼ã€‚

å¯¹ JS ES6 æ— ç¡¬æ€§ä¾èµ–ï¼Œå†…è”å¼è¯­è¨€ã€å…ƒç¼–ç¨‹ ~~`mk(x=>(x+1)*3=n, _=>ey)`*~~ çµæ´»åˆ‡æ¢ç é£ï¼Œèƒ½å­¦èƒ½ç”¨ã€‚

åŸºäº _The Little Schemer_ ä½œè€… Friedman çš„ [MiniKanren](minikanren.org) ä¸‰åŸºå…ƒï¼š`State`,`var`,`goal(eq=,all&,one|)`

- ä»¥æ›´è½»å¿«çš„å¿ƒæƒ…ï¼Œå­¦ä¹ æ¯” Scala/Haskell æ›´å°ä¼—çš„ã€è¢«ç¥åŒ–çš„æŠ€æœ¯å†…å®¹
- æ±‚å€¼ã€é€†æ¨ï¼Œåªé æ­£åå‡½æ•°ä¸å¤Ÿï¼Ÿ `mk.go((a,b)=>eq(sum(a,b), 8) )` æšä¸¾å…¨éƒ¨å…³ç³»å¯èƒ½æ€§ã€‚
- æ–°è¯­è¨€ç±»å‹æ¨å¯¼ `<T,R> ap2(f:(T)->R, :Pair<A,T>): Pair<A,R>` æƒ³äº†è§£ç»†èŠ‚ï¼Ÿä¸æƒ³åç€å†™ä»£ç ï¼Ÿä½ å¯èƒ½éœ€è¦å­¦ä¹ å…³ç³»å¼ç¼–ç¨‹æ€æƒ³ï¼

```js
concat={(a b s) //å³ appendo
  b=s&a=[] | ->(x ra rs){ a=[x,ra]&s=[x,rs]&meet(ra,b,rs) }
}
plus={(b a c) // b åœ¨é€’å½’ä¸­ä¸æ”¹å˜ï¼Œäº¤æ¢å¾‹
  a=0&c=b | ->(x ra rc){ a=1+ra&c=1+rc&meet(b,ra,rc) }
}
go.op["+"]=(a,b)=>c=>(mku.isNum(c)?plus:concat)(a,b,c)
go.opLev("+", 10,9) // è‹¥åŒå·å³è€…ä¼˜å…ˆçº§å°ï¼Œç¦»å››åˆ™è¿ç®—æ ¹èŠ‚ç‚¹å°±è¿‘ï¼Œæ›´åæ±‚å€¼
{
  a+1=3;
  1+a=4;
  ""+"hello"="hello";
  "correct"+"wrong"="wrong";
  s+"lo"="hello";

  a+b=8;
  "tesu"=a+b
}
```

æç¤ºï¼š_è¿™ä¸æ˜¯ä¸€ä¸ªæ•°å­¦è½¯ä»¶_ï¼Œæ­¤ç­‰å¼å±é€»è¾‘å¼ï¼Œå’Œæ–¹ç¨‹/ç»„å¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œå¦‚æœä½ éœ€è¦è§£æ–¹ç¨‹åŒ–ç®€ã€å¤šé¡¹å¼åˆ†æçš„ä»£æ•°è½¯ä»¶ï¼Œè¯·ç§»æ­¥ Desmos, Geoalgebra, Wolfram, funcplot, sympy, [graphEditor](https://csacademy.com/app/graph_editor/), [å‡ ä½•ç”»æ¿](https://www.dynamicgeometry.com/index.html) ç­‰ä¸“ä¸šè½¯ä»¶å­¦ä¹ 

*_ä¸å¾—ä¸å¤ç”¨ `mk(_=>eval(_))` é—­åŒ…ä¼ é€’ä¸Šä¸‹æ–‡ç»‘å®šï¼Œå› ä¸º [éšå¼evalè‡ªES5è¢«ç¦æ­¢è®¿é—®å˜é‡è¯æ³•åŸŸ](http://es5.github.io/#x15.1.2.1.1)_

## äº®ç‚¹â­

- å®Œå…¨è®¾è®¡ä¸º JS å­è¯­è¨€ï¼Œä½œä¸º `mk.load(s)` ç‹¬ç«‹è¯­è¨€æˆ– `mk(goal, _=>ey)` å†…è”æŸ¥è¯¢(<abbr title="embedded">E</abbr>-<abbr title="domain specific language">DSL</abbr>)å‡å¯
- `st.go(goal_ctx,n_st1)` çš„ç»“æœæ”¯æŒ `vals, next()` æŸ¥è¯¢ï¼Œä¾¿åˆ©ä¸å®Œæ•´ï¼Œæˆ‘å…¨éƒ½è¦ï¼
- åŒ…å«ç›¸å½“äº [microscopeKanren](http://www.adamsolove.com/microScopeKanren/) çš„é€’å½’ tracer ï¼Œä¹Ÿèƒ½å•æ­¥èµ°è¿‡å‡½æ•°çš„åº”ç”¨
- å†…éƒ¨æ”¯æŒ `+-*/` é“¾çš„åå‘ã€`Equiv.pipe` ç›¸ç­‰å…³ç³»ç¼–ç¨‹æ¨¡å‹ï¼Œ`prop(o,"bind").k.onchange` åˆ—è¡¨/å•é¡¹-ç»‘å®šå…³ç³»ï¼Œå­¦æœ¯ä¸å®ç”¨å…¼å…·
- æ”¯æŒæ‰©å……è¿ç®—ç¬¦è¡¨ã€æ”¯æŒå·¦å³ç»“åˆçš„ä¼˜å…ˆçº§ã€æ”¯æŒ `(c=>appendo(a,b,c))="wtf"` è‡ªå®šä¹‰å…³ç³»è¿ç®—ç¬¦
- å°½ç®¡æ‰€ç”¨ç®—æ³•çš†â€œé­”æ³•â€ï¼Œä»£ç è¡¨è¾¾å´ä¸€ç‚¹ä¹Ÿä¸é­”æ³•ï¼
- ç§‰æ‰¿ä½œè€…åŠ¨è‹çš„ç¼–ç¨‹é£æ ¼ï¼šä¸€åº”ç”¨å¸¦ä¸€æ¡†æ¶ï¼Œå…¬å¼€åŒæ€æ½® `mku` ç‹¬ç«‹å·¥å…·åŒ…ï¼Œå¯è¾…åŠ© DOM å¼€å‘

## å…³äº unification å½’ä¸€åŒ–ç®—æ³•

>è¿™æ˜¯ä¸€ä¸ªâ€œç¥ç§˜â€çš„åå­—ï¼Œå®ƒç”šè‡³ä¸€ç›´æ²¡æœ‰å¸¸ç”¨çš„ä¸­æ–‡ç¿»è¯‘ï¼Œæ†§æ†¬ç€CS(è®¡ç®—æœºç§‘å­¦)çš„äººï¼Œå¤šå°‘æ¬¡åœ¨[åš](http://www.yinwang.org/blog-cn/2016/03/31/no-longer-pl)[å®¢](http://www.yinwang.org/blog-cn/2013/04/21/ydiff-ç»“æ„åŒ–çš„ç¨‹åºæ¯”è¾ƒ)å’ŒçŸ¥ä¹çœ‹äººè½»ææ·¡å†™åœ°æåŠå®ƒï¼Œä»…æœ‰åå­—ã€‚

_å¯æƒœï¼Œæˆ‘ä»¬çš„å¿ƒæƒ…å¾—ä¸åˆ°å„è·¯ã€Œå¤§ç¥ã€ã€Œå­¦éœ¸ã€ã€Œå¤©æ‰ã€çš„å‚æ€œï¼Œè¢«å†—æ‚æ— è¦ç‚¹çš„ç¤ºèŒƒé˜»æŒ¡åœ¨ç†è§£çš„å¤§é—¨å¤–ã€‚_ æˆ‘ä»¬é”™äº†å—ï¼Ÿ

æ•°æ®ç»“æ„æ˜¯ç®—æ³•çš„ç›®çš„ï¼Œæˆ–è€…è¯´ä¼´ç”Ÿç‰©ï¼ŒäºŒè€…ä¸èƒ½å®Œå…¨éš”ç¦»ï¼›å¯¹äºä»»ä½•ç°æœ‰å‡½æ•°å¼/OOP è¯­è¨€ï¼Œå½’ä¸€åŒ–çš„ä¼´ç”Ÿç‰© `State` çº¦ç­‰ `Map` å¯¹è±¡å« `unify(a,b); get(v)` ä¸¤æ“ä½œã€‚

`get` æ˜¯è§£å¼•ç”¨æ·±æ‹·è´ï¼Œè®© `v` å’Œ `State` é—´è„±ç¦»å…³ç³»ï¼Œä¹Ÿç§° `grab`ï¼›`unify` æˆ–è®¸èƒ½ä»¤ä¸¤é‡æ»¡è¶³ `isEq` çš„ç­‰å·æ¡ä»¶ï¼Œè¿”å›å½’ä¸€çš„å€¼ã€‚

>å½’ä¸€åŒ–çš„è¦ç‚¹åœ¨äºï¼Œ_ä»»ä½•åœ°æ–¹(å…¨å±€,æ•°ç»„å†…â€¦)_ çš„å˜é‡å’Œ _ä»»æ„ç±»å‹(çœŸå‡,æ•°æ–‡,é”®å€¼è¡¨â€¦)_ çš„å€¼ä¸€æ ·ï¼Œæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œ__å˜é‡å’Œå€¼éƒ½æ˜¯å€¼__ã€‚

ES6 è§£æ„ `let [a,b]=pair` å `a=pair[0]`ï¼Œå®ƒä¸èƒ½ `pair=[a,b]` è§£æ„ï¼Œæ¯•ç«Ÿ `[a,b]` æ¨¡å¼åœ¨ç­‰å·åˆ†å·¦å³ï¼Œè§£æ„æˆ–æ„é€  è¯­ä¹‰ä¸Šæœ‰åˆ«ã€‚

è¿™ä»…ç±»ä¼¼èƒ½ `([a,b],i)=>` é€’å½’æ„é€ çš„æ¨¡å¼ matcher ã€Œå½¢ `cfg=>(o=>{})` å¯ç»„åˆå­ çš„ `objOut.match({a:gets(0)}) ([2,6])`ã€

å…³ç³»å¼ä¸Šçš„ç­‰å·æ˜¯çœŸçš„åªæœ‰æ°¸è¿œäº’ç­‰ï¼Œæ²¡æœ‰ __ç¼©å†™/ä¿æŒç•™å­˜/é‡èµ‹å€¼__ çš„è¯­ä¹‰ã€‚

`unify(a,b)` åˆ†ä¸‰ç§æƒ…å†µï¼Œåœ¨ a,b å…¶ä¸€æ˜¯å˜é‡æ—¶ï¼Œåªéœ€èµ‹å€¼å³å¾—åˆ°ç›¸ç­‰ï¼›äºŒè€…éƒ½æ˜¯å€¼åˆ™ `isEq(a,b)`ï¼Œä¸ç­‰åˆ™å¤±è´¥ï¼›__éƒ½æ˜¯å˜é‡ä¹Ÿèƒ½åƒæœ‰è¾¹æ˜¯å€¼ä¸€æ ·__ å•å‘èµ‹å€¼ï¼Œæ¯•ç«Ÿ `get(v)` é‡Œ v å¯ä»¥æ˜¯ value/variable ä»»ä¸€å•Šã€‚

unify ç»“æœçš„ç”¨é€”æ¯”å¦‚ï¼Œ`concat("","ok","ok")` åœ¨é€’å½’ä¸­åªéœ€åˆ¤æ–­ ok=ok ï¼Œå…¶æ²¡æœ‰å¤–éƒ¨å˜é‡ï¼Œè€Œ `concat(x,"k","ok")` åªéœ€è‡ªå¤´éƒ¨ï¼Œé€’å½’åˆ°å°¾éƒ¨ 'k'ï¼Œè§£æ„å‡º `a=[x,ra]` çš„é“¾æ¡å³å¯ã€‚

### åŸºäºå˜é‡å…³ç³»çš„ç¼–ç¨‹

å…³ç³»å¼åªå¼•å…¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå°±æ˜¯ï¼š __ä»»ä½•ç»“æ„ä¸Šéƒ½èƒ½å«å˜é‡ã€å˜é‡ä¹Ÿèƒ½åƒå€¼ä¸€æ ·ï¼Œåˆ°å¤„ä¼ é€’__

ä¸”ä¸ºã€å˜é‡ã€æ¦‚å¿µå¼•å…¥äº†ä»…ä»…ä¸€ä¸ª __åŸºæœ¬æ“ä½œï¼šå§‹ç»ˆä¸å€¼æˆ–å˜é‡ç›¸ç­‰çš„å…³ç³»__ï¼Œé‚£ä¹ˆä¸ç­‰å¼ `x<5` æ€ä¹ˆåŠï¼Ÿæ˜¾ç„¶èƒ½æ‹†è§£ä¸º `x=4,x=3, ...`ï¼Œå®ƒè¢«ç§°ä¸º goal __æšä¸¾ç›®æ ‡__ï¼Œè€Œæœ€æœ€ä¸èƒ½å°‘çš„åªæœ‰è¿™ä¸€ä¸ªã€ç­‰å·ã€

### å½“è®¨è®ºç¼–ç¨‹ï¼Œæˆ‘ä»¬åˆ°åº•åœ¨è°ˆå•¥

>[ä¸æƒ³çœ‹](#ä¸ºä»€ä¹ˆè¿™äº›é—®é¢˜å¾ˆå°‘äººè®²æ˜ç™½)

è¿‡ç¨‹å¼æµæ§ï¼Œ__é¡ºåºã€åˆ¤æ–­ã€é‡å¤__ï¼Œå³é¡ºåºåˆ†æ”¯å¾ªç¯ï¼Œ`false&&console.log(1)`ï¼Œ`throw` å’Œ `yield` åŠ `let,const,class,export`, æ—§ `new function` ç­‰ç»“æ„å£°æ˜å’Œ `map,filter,sort` å‡½æ•°å¼æ“ä½œæ„æˆäº†ç°ä»£ JavaScriptã€‚

æ‚ä¸ƒæ‚å…«çš„ `æŸer,æŸor` å’Œåƒå¥‡ç™¾æ€ªçš„ `Manager,Builder,Factory,Adapter,Handler,Middleware` ç±»/æ¥å£æ„æˆäº†ã€Œé€ äººå¤§å¸ˆã€  ç°  ä»£ Javaã€‚

ä»…ä»…ä¸€ä¸ªç­‰å·çš„äº¤æ¢æ€§(symmetric)ã€ä¼ é€’æ€§(transitive)ã€å®ƒæ„ç­‘çš„è‡ªåæ€§(reflexive,identity,å¼ºequality)å°±å®ç°äº† `mk(x=>append(x,"çš„","æ˜¯çš„"))=="æ˜¯"` ï¼Œä½†ä¹Ÿåªæ˜¯æŸç§ã€ŒæŸ¥è¯¢ã€è€Œä¸å«æœ‰å†™å…¥è¾“å‡ºçš„æ“ä½œè¯­ä¹‰

å…³ç³»å¼çš„ [æ–°æ¦‚å¿µ](#åŸºäºå˜é‡å…³ç³»çš„ç¼–ç¨‹)ï¼Œæ˜¯ä¸æ˜¯å’Œå‡½æ•°å¼çš„â€œ__å¸¦çˆ¶å±‚å˜é‡å‚æ•°çš„å‡½æ•°__ å«é—­åŒ…ï¼Œä»»ä½•æ•°æ®ä½“éƒ½èƒ½å«é—­åŒ…ã€é—­åŒ…èƒ½ä½œä¸ºå‡½æ•°å‚æ•°â€æœ‰ç‚¹åƒï¼Ÿ

è€Œé¢å‘å¯¹è±¡çš„ Object ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ª `o.wtf(1) == send_o(:wtf,1)` (Ruby è‡ªå¸¦ `Object.send`) çš„é—­åŒ…ï¼Ÿ

åªä¸è¿‡å¯¹äºå»ºæ¨¡ä¸è‰¯çš„ Java ï¼Œå®ƒä¼šæš´éœ²å‡ºèµ¤è£¸çš„å­—æ®µ field è€Œä¸æ˜¯ `getX` property è€Œå·²ã€‚__å¯¹è±¡å°±æ˜¯èƒ½è®¿é—®å±€éƒ¨å˜é‡ã€ä»æŸæ®µå¼€å§‹æ‰§è¡Œçš„å‡½æ•°é—­åŒ…__

ä»»ä½•é final çš„æ–¹æ³•åŠ¨è¯éƒ½æ˜¯è™šçš„ï¼Œã€Œè™šã€æ„å‘³ç€æä¾›ç€å…¼å®¹å®ƒçš„å­ç±»å‹å¯¹è±¡(å¦‚ `new Runnable(){}`)ï¼Œå…¶è¡Œä¸ºã€å³æ–¹æ³•ç‰ˆæœ¬æ˜¯å¯ä¸åŒçš„(override-n)ï¼Œå°è£…ç»§æ‰¿ã€æŠ½è±¡å¤šæ€æ˜¯ OOP çš„å››å¤§é‡è¦ç‰¹æ€§ï¼ŒC++ çš„ vtable åœ¨å¯¹è±¡å†…å­˜ä¸Šå¼€è¾Ÿæ–¹æ³•æŒ‡é’ˆåŒºï¼ŒRust çš„ fat pointer åŒæ—¶æŒæœ‰æ•°æ®å¯¹è±¡å’Œå…¶ä¸Šæ“ä½œçš„å‡½æ•°ä»¬çš„è¡¨æŒ‡é’ˆï¼ŒOOP çš„æœ¬è´¨ç±»ä¼¼çº§è”æˆå‘˜æŸ¥æ‰¾çš„ dict ç»“åˆå…ˆçˆ¶åå­çš„ new-construct/initialize æ“ä½œï¼Œ`this` ä¸»è¯­çš„ .å· é“¾åªæ˜¯æœ€æµ…æ˜¾çš„â€œé¡ºè¯­åºâ€è¯­æ³•ç³–ï¼Œå…³é”®åœ¨äºæ˜“æ‡‚çš„ç»„ç»‡ä¸å°è£…ã€‚

>æ±‡ç¼–+ç¼–è¯‘å™¨=ç»“æ„åŒ–ç¼–ç¨‹
+GCå†…å­˜å¯¹è±¡ç®¡ç†=é¢å‘å¯¹è±¡/å‡½æ•°å¼
+unify&é¢å‘goalæšä¸¾Stateç¼–ç¨‹=å…³ç³»å¼

__ç¼–ç¨‹èŒƒå¼è¯´åˆ°æ ¹æœ¬éƒ½æ˜¯äº’é€šçš„__ï¼Œåªæœ‰å…¶èƒŒåçš„ GC, coroutine, exception, æ¨å¯¼, è¯­æ³•ç³– ç­‰ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼Œæ„æˆäº†å®ƒä»¬çœŸæ­£çš„å…‰å½©ã€‚

å­¦ç©æœ¬é¡¹ç›®çš„ä½ ï¼Œå·²ç»ä» C/VB å’Œ Java/C# çš„è¡¨è¿°å¼æˆ– OOPã€Kotlin/Ruby/Py/JS çš„å®šä¹‰å¼ï¼Œè¾—è½¬åˆ° miniKanren çš„æè¿°å¼ï¼

## å…³äºä¸­ç¼€é“¾å’Œ JS åˆæ³•åŒ–è½¬è¯‘ è§£æå™¨

å¯¹äº `{(a) a}` å’Œ `->(a b){}`ï¼Œ`subPaired(pr,dm,s,op)` ç”¨äºå°†å…¶è½¬åŒ–ä¸º `(a)=>{const {me}=go; go.callee=f;}` å®šä¹‰å’Œ `puts((a,b)=>)` è°ƒç”¨ï¼Œè€Œå¯¹äºä¸­ç¼€è¿ç®—ç¬¦ï¼Œåˆ‡åˆ† `noSplitIf(p,re,s)` å’Œæ­¤ç®—æ³•ï¼š

```js
sP=[..."()"],
optab={
  ["+"]: [3, j("add")],
  ["*"]: [2, j("mul")],
  ["="]: [1, j("eq")],
  [...sP.map(k=>[k,0])]
}
reord=(xs,w,st=[])=>{
  let [sA,sB]=sP,
  save=x=>{let x1;
    if(x==sA) st.push(x); else if(x==sB) while((x1=st.pop())!=sA)w(x1);
    else return true;
  },
  close=()=>st.reverse().splice(0,n(st)).forEach(w);
  xs.forEach(x=>!(x in optab)?w(x):
    save(x)|| (n(st)&&l(x)<l(x1(st))? 0:close())||st.push(x)
  );
}
```

op-reorder é‡æ’ç®—æ³•ï¼Œè¿™æ˜¯å¤§å­¦ç¼–è¯‘åŸç†çš„å¿…å­¦å†…å®¹ã€‚æˆ‘ä¸€ç›´å¾ˆå®³æ€•å®ƒéš¾ï¼Œè€Œä¸”æˆ‘è§è¿‡ç¼–è¯‘åŸç†ä¹¦é‡Œå¹¶æ²¡æœ‰æåŠé€†æ³¢å…°åŒ–ã€‚

å…¶å®å°±æ˜¯ `!isOp(x)w(x) : save(x)|| (x<x1(st)? 0:close)||pu(x)` çš„ã€Œ*/ å¤§å…ˆé€†å‡ºã€+- å°åå†å‡ºã€é€»è¾‘ï¼Œå‰åºåˆ™ã€Œå°å…ˆé€†å‡ºã€å¤§åå†å‡ºã€å¹¶è¦é‡æ’å‚æ•°

è¿™ä¸åƒ _LLVM Cookbook_ ä¸­çš„[é€’å½’ä¸‹é™](https://github.com/ParserKt/ParserKt/blob/master/src/commonMain/kotlin/org/parserkt/pat/complex/InfixPattern.kt#L33)ä¸èƒ½å¤„ç† &=| å³ 2,3,1 åºï¼Œå®ƒåœ¨ &= æ—¶å°±æ–­å®šå³è¾¹èµ°é€’å½’äº†â€¦â€¦ åœ¨ &= 2,3 æ—¶ `x>(xL=x1(st))` æ•…æ¥è¾ƒ =| å± `x<x1` æ•… close å‡º =& ï¼Œå«å¯ä¼ é€’æ€§ã€ç®€å• å†…å­˜é«˜æ•ˆã€è¢«åŠ¨çŠ¶æ€è½¬ç§»ï¼ŒåŠ ä¸Š `i%2==0? atom:op` å°±èƒ½å˜æµè¯»å–ç»„åˆå­ï¼Œç¨å¾®ç”¨æ ˆå°±èƒ½ reduce å‡ºåµŒå¥—ç»“æ„

## ä¸ºä»€ä¹ˆè¿™äº›é—®é¢˜å¾ˆå°‘äººè®²æ˜ç™½

å¦‚æœä½ çœ‹æ‡‚äº†ï¼Œè¯·å°½æƒ…å‘æ˜ä¸€ç•ªå§ï¼Œä»Šåä½ çœ‹ç¼–ç¨‹çš„è§†è§’åˆä¼šå¢åŠ ä¸€é¢ï¼›è‹¥ä½ æ²¡çœ‹æ‡‚ï¼Œè¯·æš‚å…ˆè¯»ç‚¹åˆ«çš„ï¼Œåªè¦åŠŸå¤«æ·±ã€‚

åœ¨é‚£é¥è¿œçš„ 1958 å¹´ï¼Œ60å²+ å•Šï¼ŒLisp ä½œä¸ºâ€œç ”ç©¶äººå·¥æ™ºèƒ½çš„äº§ç‰©â€è¯ç”Ÿäº†ï¼Œè€Œ 75 å¹´ Scheme è¯ç”Ÿäº†ï¼Œè§£å†³äº† lisp æ²¡è¯æ³•ä½œç”¨åŸŸï¼Œå…¨å±€ã€æ—¶åºè¦†ç›–çš„å‘½ååˆ°å¤„å†²çªçš„é—®é¢˜ã€‚ï¼ˆä¹Ÿä¸è¯´ä¸èƒ½ç”¨å§ï¼Œå°±æ˜¯ä¸ç¬¦ç›´è§‰ã€æœ¬è´¨ä¼¼Cï¼‰

å½“ç„¶ï¼Œæˆ‘ä¸å–œæ¬¢å­¦æ—¶å°šåœˆå»è®²å†å²ï¼Œé‚£å¯¹æŠ€æœ¯æ²¡æœ‰è£¨ç›Šï¼Œæ‰€ä»¥æˆ‘åªè¯´ä¸ªäººè¯„åˆ¤ï¼š

- Scheme ç³»çš„æ—§å‘½åæ³•ï¼Œ `procedurep=isFunc, pairp=isAry&&n==2` å°†å…¶ã€Œå‘½é¢˜ã€ç±»å‹åç½®ï¼Œ__å¤ªè¿‡è‡ªç„¶è¯­è¨€åŒ–çš„å‘½åå¯¹æ˜“è¯»æ€§ä¸åˆ©__ï¼Œå°¤å…¶å¯¹éè‹±è¯­æ¯è¯­è€…
- åŸç‰ˆå‡ ä¹æ²¡æœ‰ä»»ä½•æ³¨é‡Šâ€”â€”æ›´åˆ«æä½ ç°åœ¨çœ‹åˆ°çš„å¤§æ€è·¯çš„çº²é¢†ï¼Œå…¶å‘½åäº¦è‹±è¯­è‡ªé€ è¯åŒ–ï¼Œå®ƒå¯¹æ•°æ®æ¨¡å¼çš„æè¿°ä¸å°½æ¸…æ™°
- å°½ç®¡æœ‰ `syntax-rules`, `let v ([a b]) expr` ç­‰è¯­æ³•ç³–å±•å¼€ç‰¹æ€§å’Œ `cond`, `lambda` è¡¨è¾¾å¼ç­‰å‡½æ•°å¼ä¼˜ç‚¹ï¼Œå®ƒæ¯•ç«Ÿæ˜¯å¼±åŒ–ã€Œèµ‹å€¼ã€ç­‰å‰¯ä½œç”¨çš„è¯­è¨€â€”â€”æ„å‘³ç€è®¸å¤šåˆ©ç”¨ `if(p&&p1) ; else` èƒ½ç´§å‡‘è¡¨è¾¾çš„ä¸œè¥¿åœ¨ä¸€æ¬¡æ¬¡å°¾é€’å½’è°ƒç”¨ä¸­ä¸ `cons,car,cdr` ç­‰ã€Œæç®€æ•°æ®æ„è§£é€ ã€æˆä¸ºå™©æ¢¦â€”â€”å†—æ‚æ€§æ¯”å›è°ƒåœ°ç‹±å¥½ç‚¹
- __ä»»ä½•è¯­è¨€ç›¸åŒç®—æ³•çš„ä»£ç ï¼ŒæŒ‰ä½œè€…éƒ½æœ‰ç®€ç¹ä¹‹åˆ†__ï¼Œæ— è®ºä½œè€…æœ‰å¤šèªæ˜æˆ–å¤šå¥‡æ€å¦™æƒ³â€”â€”å› ä¸ºåªæœ‰ä½ é‡è§†é˜…ç çš„ä»–äººã€é‡è§†ä¸æ–­å›æƒ³çš„è‡ªå·±ï¼Œç”¨å¿ƒæ‰èƒ½çœŸæ­£å†™å‡ºæ˜“æ‡‚çš„ä»£ç ï¼Œä¸ã€Œæ™ºå•†ã€æ— å…³
- å†—æ‚çš„ã€Œæ‰§è¡Œåˆ†æœŸã€ï¼Œå¯Œäºç¼©å†™çš„å®ç³»ç»Ÿç­‰ä¼šå½±å“ç¼–ç¨‹è€…å¿ƒæ™ºæ¨¡å‹çš„ä¸€è‡´æ€§ï¼Œç»å¸¸åˆ‡æ¢ä¸»æ¬¡è¯­è¨€çš„æ€è·¯
- __ç®—æ³•æ€æƒ³ä¸è¯­è¨€æ— å…³__ï¼Œ ES6 çš„ç®­å¤´å‡½æ•°ä¸ destruct å°½ç®¡è¤’è´¬ä¸ä¸€ï¼Œåœ¨ç¼–å†™é€»è¾‘/ç®—æ³•å¯†é›†å‹ä»£ç æ—¶ä¼šæ˜¯åˆç†æ’ç‰ˆçš„æ•‘æ˜Ÿ
- __è®¤çœŸæ¨æ•²é€‰è¯çš„ API å‘½å__ï¼Œä¸è®¸å¤šç‰ˆæœ¬çš„ `conj/disj/fresh` æˆ– `both/either/intro` ä¸ä¸€æ ·ï¼Œmkey çš„ `all/one/puts` é•¿åº¦å‡è¡¡ã€ç”¨è¯å€¾å‘éä¸¥è‚ƒåŒ–ï¼Œä¸”ä¸ºè¡¨è¾¾å¼æä¾›äº†ä¸­ç¼€å½¢å¼

å…¶å®æˆ‘ä¹Ÿæ˜¯çœ‹ Ruby [Hello Declarative World](https://codon.com/hello-declarative-world#unification) æ•´ç†å¤åˆ»å‡ºçš„ï¼ˆ_ä½†åˆ«è§‰å¾—è¿™ç®€å•ï¼Œæœ‰ç§ä½ å»çœ‹åŸæ–‡è‡ªå­¦_ï¼‰ï¼Œè¿™é‡Œè¿˜æ˜¯ä¸å¾—ä¸ä½©æœ Rb/Py/JS ç³»ç¨‹åºå‘˜çš„å‚å·®ï¼ŒçœŸçš„æ˜¯èƒ½ä¸Šä¸‹éƒ½èƒ½è®©äººçœ¼ç•Œå¤§å¼€çš„åœˆå­ã€‚

â€œMonkey çš„ç”¨è¯å’Œåˆ†ç»„æ˜¯å…¨æ–°ç‹¬ç«‹è®¾è®¡çš„ï¼Œåªæœ‰ k->v,unify ç­‰å…³é”®é€»è¾‘ç»“æ„ä¸å¯èƒ½æ”¹å˜â€

## é¡ºä¾¿ä¸€æ

>å¦‚æœä½ ä¸å…³å¿ƒ Scheme ç‰ˆå®ç°ï¼Œè¿™é‡Œæ²¡æœ‰æ–°å†…å®¹

åŸç‰ˆå®ç°çš„ `walk,walk*` éƒ½æ˜¯å› ä¸ºå…¶ `Map` ç”¨ [k,v]pairs assoc æ„æˆï¼Œè¦é‡å†™å…¶å•é¡¹ï¼Œè€Œ `unify/reify` å…¶äºŒçš„å«ä¹‰ç›¸å½“äº `get+grab` ï¼ˆæœ¬ç‰ˆä¸ºç®€åŒ–é€»è¾‘ï¼Œæ²¡æœ‰åœ¨å‰åŠç‰‡å¼ºåˆ¶ç­‰å·ä¼ é€’æ€§ï¼‰

æœ¬ç‰ˆç›¸å½“äº 39 è¡Œ [muKanren](http://webyrd.net/scheme-2013/papers/HemannMuKanren2013.pdf)ï¼Œæœ¯è¯­å¯¹ç…§ï¼š

ç¼©å†™ä¾§ï¼š

ç¬¦å·|mky|muK
:--|:-:|:--
å˜é‡|k|u/x/v
å–å€¼|v|v
çŠ¶æ€è¡¨|st/s|s
æƒ°æ€§æµ|s|$
æ“ä½œ|op/f|f
é…å¯¹||"a/b"
å­—å…¸|d|

mky çš„ç¼©å†™ç¬¦åˆã€Œå¸¸è§åŒ–è§£é‡Šç”¨é•¿åã€æ•°å­¦åŒ–ç”¨é€”ç”¨å•å­—ã€çš„æƒ¯ä¾‹ã€‚

```plain
mplus=eachNext=interleave,
mzero=[], unit=x=>[x], take=nextN
bind($,g0)=let ss=g0(s0),g=s=>[s] in eachNext(nextAll(ss).flatMap(s1=>g(s1)) )
^Finite DFS æƒ°æ€§å¹¿åº¦æœç´¢ï¼Œä»£ç é‚£ä¹ˆç®€å•ï¼Œåå­—è¿™ä¹ˆé«˜æ·±
pull=Iterable->Iterator/pull, Scm has no Generator so.
assp/q=assoicated-p/q

State: call/fresh=vars&ofIter, fresh=puts,
  ext-s(x,v,s)=s.fork(x,v)
  walk(u,s)=s.get(u)
  walk*=walk-Extended=grab(not cached)
  run=ofIter, run*=of,

  cfg:var=eqSym[0],var?=isSym,[var=] not required(deref-ed in get(v))
  [â‰¡] eq(a,b)
  disj=one, conj=all
  conde=map2D(one,all)
```

ä¸»è¦åŒºåˆ«åœ¨äºæˆ‘ä»¬çš„åŸºå…ƒæ“ä½œé™¤ unify/reify å¤–è¿˜åˆ†å‰²å‡º isEq ï¼Œå¦å¤–å–„ç”¨ `reduce((a,x)=>,a)` æ“ä½œï¼Œ unify çš„æ•°æ®ç»“æ„æ”¯æŒæ˜¯æ•°ç»„/å¯¹è±¡ï¼Œä¸æ­¢ pairï¼›`all`,`one` çš„å‚æ•°ä¸æ­¢ä¸¤ä¸ªï¼Œä¹Ÿæ²¡æœ‰åœ¨ç»“æœä¸Šè®¡æ•° `puts` è°ƒç”¨(å…¨å±€çš„ç¬¦å·åŒåç»„è‡ªåŠ¨ç¼–å·)

æµä¸ä¸€å®šæ˜¯å¯å½’çº³(æœ‰ç©·)çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…è®¸æŒ‰ `n_st1` ä¸ºå•ä½ç»§ç»­æŸ¥è¯¢ï¼Œè¿™æ˜¯ API çš„ä¾¿åˆ©åŒ–è®¾è®¡ã€‚

å’Œ miniKanren ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„ `fork(k,v)` æˆ– get æ²¡æœ‰æ£€æŸ¥å¯¼è‡´æ­»å¾ªç¯/æ ˆæº¢çš„é€’å½’å¼•ç”¨ `occursâˆš`ï¼Œå› ä¸ºæ­£ç¡®ç¼–ç¨‹ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚

### æ‰©å±•ç»†èŠ‚çš„å¤§è‡´å®ç°

- `[a,ra]` å³ `[a,...ra]` çš„åŒ¹é…ï¼š
- `{a:1,_asObj:rkv}`
- `1+a*b` çš„è§£æ„ï¼š
- `hex(256)`, `hex(i)="FF"` ç­‰ç®—ç¬¦çš„è§£æ„ï¼š

`mk(_=>1+2*3)` çš„ç»“æœæ˜¯ `(var)=>states` ï¼Œå¦‚æœé‡åˆ°å†…å®¹æ˜¯å‡½æ•°çš„æƒ…å†µï¼Œmk ä¼šé»˜è®¤å…¶æ˜¯ `mk(x=>1+2*3==x)` å¹¶ç»™å‡ºæ­£å‘è®¡ç®—ç»“æœ

>æœ‰è®ºæ–‡é‚£å‘³äº†ï¼Œè¯è¯´ Py,JS,Lua,Java é‡å†™çš„äººæ€ä¹ˆéƒ½é‚£ä¹ˆ<abbr title="è¿™ä¸ªå†°å†°å°±æ˜¯é€Šå‘ï¼ˆx">é€Š</abbr>ï¼Œäººå®¶ 30 è¡Œå®ç°çš„ä½ ä»¬æ 300 è¡Œï¼Œå¼„å¾—åƒ Py è¿™äº›è¿˜æ²¡ Scheme é«˜çº§ï¼Ÿ

## æ„Ÿè°¢

- ç†¬äº†ä¸¤å¤©è°ƒå‡ºä¸€ä¸ªä¸­ç¼€é“¾è§£æå™¨ã€æƒ³äº†ä¸¤æ™šæ€ä¹ˆåœ¨åº”ç”¨é‡Œæºæ›´å¤šå…ƒç¼–ç¨‹çš„ [duangsuse](#Monkey%20ğŸ’å…³ç³»å¼æ±‚è§£å™¨)
- å‘å¸ƒ [Hello, declarative world](https://codon.com/hello-declarative-world) çš„ Rubyist åŠä»–å¯¹ mk.scm åšçš„ç®€åŒ–
- ç‚¹é†’äº†æˆ‘ï¼Œæœ‰é€†æ³¢å…° op-reorder ç®—æ³•çš„ä¿¡æ¯å­¦/æ•°ç†åšä¸» [Xecades](xecades.xyz)
- è®©æˆ‘ç¬¬ä¸€æ¬¡è§è¯†åˆ°ç±» C++ è¯­è¨€çš„ LLVM ç¼–è¯‘å™¨å®æˆ˜ï¼Œä»è€Œæ›´æ¸…æ™°çœ‹è§ç±»å‹æ¨å¯¼ä¸å¤šæ€çš„ï¼Œå…´è¶£ä½¿ç„¶ä¿¡æ¯å­¦åšä¸» [Mivik](mivik.gitee.io)
- åšæŒçœ‹åˆ°ç°åœ¨è¿˜æ²¡è§‰å¾—æ— èŠçš„ä½ ï¼Œ__åŠ æ²¹ï¼__

## é“¾æ¥

- [åŒç±»é¡¹ç›®æ¦‚å†µ](picked-impl.md)
- [Webyrd's interactive mK lesson](http://io.livecode.ch/learn/webyrd/webmk)
- [blog of a Clojure ver](http://mullr.github.io/micrologic/literate.html#sec-5-2)
- [Sokuza Kanren](http://okmij.org/ftp/Scheme/misc.html#sokuza-kanren)
- [Y:microscopeKanren](https://news.ycombinator.com/item?id=8395079)
- [SF:Kanren](http://kanren.sourceforge.net/)
- [GH:tca/Veneer](https://github.com/tca/veneer) &[editor](http://tca.github.io/veneer/examples/editor.html) with `.demo`
- [quines generator](https://github.com/webyrd/quines)
- [Core.Logic Docs - Clojure](https://corelogicdocs.herokuapp.com/org.clojure-core.logic/clojure.core.logic)
- [parser combinator](https://github.com/duangsuse-valid-projects/Share/blob/master/HTMLs/school/js/scan_fin.js)
- [mk,equiv,propBind,scan å¤§æçº²](making_reco/å¤§æçº²1.md)
